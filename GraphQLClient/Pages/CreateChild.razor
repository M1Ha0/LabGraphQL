@page "/CreateChild"
@using BlazorBootstrap
@using GraphQLClient.DataAccess
@using GraphQLClient.DataAccess.Model
@inject NavigationManager NavigationManager
<h3>Добовление Ребенка</h3>
<div class="row">
    <EditForm Model="@createChild" OnValidSubmit="@CreateButtonClick">
        <DataAnnotationsValidator />
        <ValidationSummary/>
        <div class="form-group">
            Имя:<InputText id="name" @bind-Value="createChild.Name"
                           class="form-control" />
        </div>
        <div class="form-group">
            Дата рождения:<DateInput id="birhDate" @bind-Value="createChild.BirhDate"
                             class="form-control" />
        </div>
        <div class="form-group">
            Родитель:<InputSelect TValue="int" @bind-Value="createChild.ParentId"
                                       class="form-control">
                @foreach (var par in parentList!)
                {
                    <option value="@par.ParentId">@par.Name</option>
                }
            </InputSelect>
        </div>
        <button type="submit" class="btn btn-success">Создать</button>
    </EditForm>
</div>
<a href="/ChildView"><i class="bi bi-backspace"></i></a>
@code
{
    private ChildReturnModel cildReturnModel =
    new ChildReturnModel();
    private CreateChildModel createChild =
    new CreateChildModel();
    private IEnumerable<ParentReturnModel>? parentList;

    protected override async Task OnInitializedAsync()
    {
        parentList = await GetParents();
    }
    private async Task CreateButtonClick()
    {
        try
        {
            string query = "mutation{createWithParentName(name:" + createChild.Name + ",birhDate: \"" + createChild.BirhDate + "\",parentId:" + createChild.ParentId + "){name,parentId}}";
            string graphQLQueryType = "createWithParentName";
            var result = await Mutation.ExceuteMutationAsyn<CreateChildModel>(graphQLQueryType, query);
            NavigationManager.NavigateTo($"ChildView");
        }
        catch (Exception)
        {
            throw;
        }
    }
    private async Task<IEnumerable<ParentReturnModel>> GetParents()
    {
        try
        {
            string query = "query{allParentOnly{parentId,name}}";
            string graphQLQueryType = "allParentOnly";
            return await Query.ExceuteQueryReturnListAsyn<ParentReturnModel>(graphQLQueryType, query);
        }
        catch (Exception)
        {
            throw;
        }
    }
}